/* HouseHold ImplementationValidator LegacyLayer SignalsAbs SignalsAutoInsertion SignalsBsc SignalsIds SignalsTvp SignalsVlp */
(()=>{var Yt=Object.defineProperty,Be=Object.defineProperties,Ve=Object.getOwnPropertyDescriptor,je=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var zt=(o,t,e)=>t in o?Yt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,qt=(o,t)=>{for(var e in t||(t={}))ze.call(t,e)&&zt(o,e,t[e]);if(pe)for(var e of pe(t))Ye.call(t,e)&&zt(o,e,t[e]);return o},Kt=(o,t)=>Be(o,je(t)),i=(o,t)=>Yt(o,"name",{value:t,configurable:!0});var s=(o,t,e,r)=>{for(var n=r>1?void 0:r?Ve(t,e):t,l=o.length-1,d;l>=0;l--)(d=o[l])&&(n=(r?d(t,e,n):d(n))||n);return r&&n&&Yt(t,e,n),n};var a=(o,t,e)=>(zt(o,typeof t!="symbol"?t+"":t,e),e);var S=(o,t,e)=>new Promise((r,n)=>{var l=h=>{try{m(e.next(h))}catch(f){n(f)}},d=h=>{try{m(e.throw(h))}catch(f){n(f)}},m=h=>h.done?r(h.value):Promise.resolve(h.value).then(l,d);m((e=e.apply(o,t)).next())});var u={"4817":{adServerId:1360,customTracking:{c1:{type:"targeting",key:"permutive"},c3:{type:"targeting",key:"rec_ord"},c4:{type:"targeting",key:"page_type"},c5:{type:"targeting",key:"hb_pb"},c6:{type:"targeting",key:"group"}},adPositionKey:"slot"}};var Ht={queueAdRequest:o=>{var t;try{(t=o.callback)==null||t.call(o),o.callback=null}catch(e){}},defineSlot:(o,t)=>{},adRendered:(o,t)=>{},adRemoved:o=>{},getTargeting:o=>({}),addEventListener:(o,t)=>{},removeEventListener:(o,t)=>{},toggleDebugMode:()=>{console.log("%c[UT-DEBUG]%c Debug mode is not available for this tag.","color: red","color: intial")},_debugScriptLoaded:()=>{},onSlotVisibleForTime:(o,t,e)=>{}};var $t=class $t{constructor(){a(this,"isEntryModule",!0)}};i($t,"EntryModule");var w=$t;var Ut=class Ut{constructor(t){a(this,"_error");a(this,"_message","unknown");a(this,"_trace",[]);if(t instanceof Ut)return t;t instanceof Error&&(this._error=t,this._message=t.message)}get error(){return this._error}get message(){return this._message}get trace(){return this._trace}addToTrace(t){this.trace.unshift(t)}};i(Ut,"TracedError");var gt=Ut;var Wt=class Wt{constructor(t,e){a(this,"window");a(this,"dvtag");a(this,"modules",new Map);a(this,"errorHandlers",[]);a(this,"errors",[]);var r;this.window=e,this.window.dvtag=(r=this.window.dvtag)!=null?r:{},this.dvtag=this.window.dvtag,this.dvtag._core=this;for(let[n,l]of Object.entries(Ht))this.dvtag[n]=l;for(let n of t)this.createModule(n);for(let n of this.modules.values())this.applyModuleDecoration(n);for(let n of this.modules.values())this.applyErrorDecoration(n);for(let n of this.modules.values())this.applyPluginDecoration(n);for(let n of this.modules.values())this.applyApiDecoration(n);for(let n of this.modules.values())this.applyExecuteDecoration(n)}get moduleList(){return[...this.modules.keys()].map(t=>t.name)}get entryModuleList(){return[...this.modules.entries()].filter(([t,e])=>e instanceof w).map(([t,e])=>t.name)}get(t){return this.getModule(t).gateway}getByName(t){let e=[...this.modules.keys()].find(r=>r.name===t);return e!=null?this.get(e):null}getModule(t){let e=this.modules.get(t);if(e==null)throw new Error(`module not in core: ${t.name}`);return e}createModule(t){if(t.prototype.moduleConfig==null)throw new Error(`not a module: ${t.name}`);let e=new t;e.core=this,e.gateway={module:e},this.modules.set(t,e)}applyModuleDecoration(t){var n,l,d,m,h,f;let e=t.constructor.prototype.moduleConfig,r=t.constructor.name;for(let{method:A}of e){let L=t[A].bind(t),q=(d=(l=(n=this.dvtag._hooks)==null?void 0:n.interceptModule)==null?void 0:l[r])==null?void 0:d[A],_=q==null?L:q.bind(t),F=(f=(h=(m=this.dvtag._hooks)==null?void 0:m.inspectModule)==null?void 0:h[r])==null?void 0:f[A],_t=F==null?_:(...et)=>{let K=_(...et);return F(et,K),K},Dt=i((...et)=>{let K;try{K=_t(...et)}catch(vt){throw this.traceMethodError(t,A,et,vt)}return K instanceof Promise?K.then(vt=>vt,vt=>{throw this.traceMethodError(t,A,et,vt)}):K},"traced");t.gateway[A]=Dt}if(t.plugins!=null){t.pluginFunctions={};for(let A of Object.keys(t.plugins)){t.pluginFunctions[A]=[];let L=t.pluginFunctions[A];t.plugins[A]=(...q)=>{let _=[];for(let F of L)try{_.push(F(...q))}catch(_t){this.tracePluginError(t,A,_t)}return _}}}}traceMethodError(t,e,r,n){let l=new gt(n);return l.addToTrace(`${t.constructor.name}.${e}(${r.map(d=>typeof d).join(",")})`),l}traceExecuteError(t){let e=new gt(t);return e.addToTrace("@execute"),this.handleSevereError(e),e}tracePluginError(t,e,r){let n=new gt(r);return n.addToTrace(`@plugin(${t.constructor.name}, '${e}')`),this.handleSevereError(n),n}traceApiError(t,e){let r=new gt(e);return r.addToTrace(`@api('${t}')`),this.handleSevereError(r),r}handleSevereError(t){for(let e of this.errorHandlers)try{e(t)}catch(r){}this.errors.length>10||this.errors.push({message:t.message,trace:t.trace})}applyErrorDecoration(t){var r;let e=(r=t.constructor.prototype.errorConfig)!=null?r:[];for(let{method:n}of e)this.errorHandlers.push(t.gateway[n])}applyPluginDecoration(t){var r;let e=(r=t.constructor.prototype.pluginConfig)!=null?r:[];for(let{PluggableClass:n,category:l,method:d}of e)this.getModule(n).pluginFunctions[l].push(t.gateway[d])}applyApiDecoration(t){var r;let e=(r=t.constructor.prototype.apiConfig)!=null?r:[];for(let{api:n,method:l}of e)Object.defineProperty(this.dvtag,n,{value:(...d)=>{var m,h;try{return t.gateway[l](...d)}catch(f){return this.traceApiError(n,f),(h=(m=Ht)[n])==null?void 0:h.call(m,...d)}},writable:!1})}applyExecuteDecoration(t){return S(this,null,function*(){var r;let e=(r=t.constructor.prototype.executeConfig)!=null?r:[];for(let{method:n}of e)try{yield t.gateway[n]()}catch(l){this.traceExecuteError(l)}})}};i(Wt,"Core");var bt=Wt;var Xt=[],Jt=Xt;var g=i(o=>{let t=o.prototype,e=Object.getOwnPropertyNames(t).filter(r=>{var n;return r!=="constructor"&&((n=Object.getOwnPropertyDescriptor(t,r))==null?void 0:n.value)instanceof Function});t.moduleConfig=e.map(r=>({method:r})),Xt.push(o)},"moduleClass"),U=i(o=>t=>{},"attachModule"),C=i((o,t)=>{var e;o.executeConfig=(e=o.executeConfig)!=null?e:[],o.executeConfig.push({method:t})},"executeMethod"),p=i((o,t)=>(e,r)=>{var n;e.pluginConfig=(n=e.pluginConfig)!=null?n:[],e.pluginConfig.push({PluggableClass:o,category:t,method:r})},"pluginMethod"),rt=i(o=>(t,e)=>{var r;t.apiConfig=(r=t.apiConfig)!=null?r:[],t.apiConfig.push({api:o,method:e})},"apiMethod"),fe=i((o,t)=>{var e;o.errorConfig=(e=o.errorConfig)!=null?e:[],o.errorConfig.push({method:t})},"errorMethod");var Tt=i(o=>{if(o==null)return[];let t=he(o);return t!=null?[t]:Array.isArray(o)?o.map(he).filter(e=>e!=null):[]},"parseSlotSizes"),he=i(o=>{if(o==null)return null;if(typeof o=="string")return{label:o};if(Array.isArray(o)){if(o.length===1&&typeof o[0]=="string")return{label:o[0]};if(o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number")return{width:o[0],height:o[1]}}if(typeof o=="object"){let{label:t,width:e,height:r}=o;if(typeof e=="number"&&typeof r=="number")return{width:e,height:r};if(typeof t=="string")return{label:t}}return null},"parseSlotSize");var Se=i(o=>{try{return o.getSizes()}catch(t){return[]}},"getGptSlotSizesSafe");var Mt=i(o=>{let t=o.split("/").map(n=>n.trim()).filter(n=>n.length>0);if(t.length<2)return;let e=t[0].split(",",1)[0],r=Number(e);return Number.isNaN(r)?void 0:`${r}`},"getNetworkCodeFromAdUnit");var Nt=i((o,t)=>{let e=o.getAdUnitPath(),r=Mt(e);return{id:e,network:r,sizes:Tt(Se(o)),position:o.getTargeting(t)[0]}},"gptSlotToAdUnit");var Zt="dvp_spos";var H=class{_getAdServers(){try{return u}catch(t){return{}}}isAdServerConfigured(t){return t!=null&&t in this._getAdServers()}getAdServerConfig(t){var e;return t==null||!this.isAdServerConfigured(t)?{}:(e=this._getAdServers()[t])!=null?e:{}}getAdServerCustomTracking(t){var e;return t==null||!this.isAdServerConfigured(t)?{}:(e=this._getAdServers()[t].customTracking)!=null?e:{}}getAdServerId(t){if(!(t==null||!this.isAdServerConfigured(t)))return this._getAdServers()[t].adServerId}getAdPositionKey(t){var e,r;return t==null?Zt:(r=(e=this._getAdServers()[t])==null?void 0:e.adPositionKey)!=null?r:Zt}};i(H,"AdServers"),H=s([g],H);var kt,He=new Uint8Array(16);function te(){if(!kt&&(kt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!kt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return kt(He)}i(te,"rng");var x=[];for(let o=0;o<256;++o)x.push((o+256).toString(16).slice(1));function Re(o,t=0){return x[o[t+0]]+x[o[t+1]]+x[o[t+2]]+x[o[t+3]]+"-"+x[o[t+4]]+x[o[t+5]]+"-"+x[o[t+6]]+x[o[t+7]]+"-"+x[o[t+8]]+x[o[t+9]]+"-"+x[o[t+10]]+x[o[t+11]]+x[o[t+12]]+x[o[t+13]]+x[o[t+14]]+x[o[t+15]]}i(Re,"unsafeStringify");var $e=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ee={randomUUID:$e};function We(o,t,e){if(ee.randomUUID&&!t&&!o)return ee.randomUUID();o=o||{};let r=o.random||(o.rng||te)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let n=0;n<16;++n)t[e+n]=r[n];return t}return Re(r)}i(We,"v4");var re=We;var st=i(()=>re(),"uuid");var oe=class oe{constructor(t,e,r,n=st(),l=Date.now()){this.source=t;this.elementId=e;this.adUnit=r;this.uuid=n;this.creationTime=l;a(this,"_variables",new Map)}setVariable(t,e){this._variables.set(t,e)}getVariable(t){return this._variables.get(t)}hasVariable(t){return this._variables.has(t)}clearVariable(t){this._variables.delete(t)}};i(oe,"Slot");var wt=oe;var R=class{constructor(){a(this,"plugins",{slotDiscovered:(t,e)=>[],slotDestroyed:t=>[]});a(this,"_slots",{})}getSlot(t,e){var r;return(r=this._slots[t])==null?void 0:r[e]}getSlots(t){var e;if(t==null){let r=[];for(let n of Object.values(this._slots))r.push(...Object.values(n));return r}return Object.values((e=this._slots[t])!=null?e:{})}createSlot(t,e,r,n,l){var h,f;let d=this.getSlot(t,r);d!=null&&this.plugins.slotDestroyed(d);let m=new wt(t,r,n);return(f=(h=this._slots)[t])!=null||(h[t]={}),this._slots[t][r]=m,l==null||l(m),this.plugins.slotDiscovered(m,e),m}};i(R,"SlotStore"),R=s([g],R);var ne=class ne{set(t,e){t.setVariable(this,e)}get(t){return t.getVariable(this)}getOrDefault(t,e){return t.hasVariable(this)?this.get(t):(this.set(t,e),e)}getOrDefaultFromFunction(t,e){if(t.hasVariable(this))return this.get(t);let r=e();return this.set(t,r),r}delete(t){t.clearVariable(this)}};i(ne,"SlotVariable");var M=ne;var mt=i((...o)=>{let t=[];for(let e of o)if(e!=null)for(let r of e)t.includes(r)||t.push(r);return t},"mergeUnique");var E=class{constructor(){a(this,"plugins",{getAdServerTargeting:(t,e)=>[],setAdServerTargeting:(t,e,r)=>[]});a(this,"globalTargeting",{});a(this,"slotTargeting",new M)}_getSlotTargeting(t){var r;let e=(r=this.slotTargeting.get(t))!=null?r:{};return this.slotTargeting.set(t,e),e}_getTargetingKeys(t){return mt(Object.keys(this.globalTargeting),Object.keys(this._getSlotTargeting(t)))}_getTargetingValues(t,e){return mt(this.globalTargeting[e],this._getSlotTargeting(t)[e])}getTargeting(t){let e={};if(t==null)for(let r of Object.keys(this.globalTargeting))e[r]=[...this.globalTargeting[r]];else for(let r of this._getTargetingKeys(t))e[r]=this._getTargetingValues(t,r);return e}setSlotTargeting(t,e,r=!1){var d;let n=Object.keys(e),l=this._getSlotTargeting(t);for(let m of n)l[m]=mt(e[m],r?(d=this.slotTargeting.get(t))==null?void 0:d[m]:null);this.setAdServerTargeting(t,n)}setGlobalTargeting(t,e=!1){let r=Object.keys(t);for(let n of r)this.globalTargeting[n]=mt(t[n],e?this.globalTargeting[n]:null);for(let n of this.core.get(R).getSlots())this.setAdServerTargeting(n,r)}getAdServerTargeting(t,e){var r;return(r=this.plugins.getAdServerTargeting(t,e).find(n=>n.length!==0))!=null?r:[]}setAdServerTargeting(t,e){e==null&&(e=this._getTargetingKeys(t));for(let r of e)this.plugins.setAdServerTargeting(t,r,this._getTargetingValues(t,r))}_onSlotDiscovered(t){this.setAdServerTargeting(t)}};i(E,"TargetingHub"),s([p(R,"slotDiscovered")],E.prototype,"_onSlotDiscovered",1),E=s([g],E);var Xe=[[/((\?)|&)(?:amp_lite|fr=operanews)/g,"$2"],[/(^https?:\/\/)(www\.)/g,"$1"],[/(((\?)|&|%3F|%26|;)(?:utm_campaign|utm_source|utm_content|utm_term|utm_viral|utm_medium|utm_identifier|utm_key|fb_source|referrer|referer|ref|rand|rnd|randid|\.?rand|\.?partner|cb|count|adid|session|sessionid|session_redirect|param\d|userinfo|uid|refresh|ocid|ncid|clickenc|fbclid|amp_js_v|amp_gsa|ns_source|ns_campaign|ns_mchanel|ns_mchannel|ns_linkname|ns_fee|src|ex_cid|usqp|source|xid|trkid|utm_social-type|mbid|utm_brand|__twitter_impression|utm_referrer|CMP|cmp|_cmp|cq_cmp)=[^&]*)/g,"$3"],[/[/.]amp(?:\/[?&]*)?$/g,""],[/((\?)|&)(?:outputType|isFollow|suppressMediaBar|cid|ICID|icid|bdk|wtu_id_h|utm_placement|intcmp|_native_ads|traffic_source|entry|\.tsrc|autoplay|autostart|dc_data|influencer|pubdate|utm_hp_ref|redirect|service|refresh_ce|refresh_cens|xcmg|target_id|_amp)=[^&]*/g,"$2"],[/(\?|&)(?:amp)(?:&|$|=[^&]*)/g,"$1"]],Je=[[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""],[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""]],Te=i((o,t)=>{for(let[e,r]of o)t=t.replace(e,r);return t},"replaceByRules"),Ae=i(o=>{let t=Te(Xe,o);return Te(Je,t)},"normalizeUrl");var ye=i(o=>o.split("?",1)[0].split("#",1)[0],"stripUrlQuery");var Ee=i((o,t)=>{try{let e=new URLSearchParams(o),r=e.get("ctx"),n=e.get("cmp");if(r!=null&&n!=null)return{ctx:r,cmp:n,prefetch:t,legacy:!0}}catch(e){}return null},"parseInfo"),_e=i(o=>{var t;return o.pathname!=="/signals/pub.js"?null:(t=Ee(o.search,!0))!=null?t:Ee(o.hash.substring(1),!1)},"parseLegacyPagetagUrl");var Ze=1e3,tr=/^\/dvtag\/([^/]+)\/([^/]+)\/pub\.js$/,v=class{constructor(){a(this,"visit");a(this,"tagInfo");a(this,"plugins",{newVisit:t=>[]});a(this,"_normalizeUrl",Ae)}_initialize(){this.getTagInfo(),this.updateVisit(!1),this.plugins.newVisit(this.visit),this._installNavigationListener()}getTagInfo(){var t;if(this.tagInfo==null){try{this.tagInfo=this._parseTagInfo()}catch(e){}(t=this.tagInfo)!=null||(this.tagInfo={ctx:"unknown",cmp:"unknown"})}return this.tagInfo}_parseTagInfo(){let t=this.getCurrentScriptSrc();if(t==null)return null;let e=new URL(t,"https://pub.doubleverify.com"),r=e.pathname,n=tr.exec(r);if(n!=null){let[,l,d]=n;return{ctx:l,cmp:d}}return _e(e)}getCurrentScriptSrc(){var t,e;return(e=(t=this.core.window.document.currentScript)==null?void 0:t.getAttribute("src"))!=null?e:null}updateVisit(t=!0){var r,n;let e=this.getStrippedPageUrl();if(this.visit==null||this.visit.strippedUrl!==e){let l=st();this.visit={strippedUrl:e,normalizedUrl:this._normalizeUrl(this.core.window.location.href),uuid:l,sessionUuid:(n=(r=this.visit)==null?void 0:r.sessionUuid)!=null?n:l},t&&this.plugins.newVisit(this.visit)}return this.visit}getVisit(){var t;return(t=this.visit)!=null?t:this.updateVisit(!1)}getStrippedPageUrl(){return ye(this.core.window.location.href)}getNormalizedPageUrl(){return this.getVisit().normalizedUrl}getVisitUuid(){return this.getVisit().uuid}getSessionUuid(){return this.getVisit().sessionUuid}_installNavigationListener(){let{window:t}=this.core,e=i(()=>this.updateVisit(!0),"cb");t.navigation!=null?t.navigation.addEventListener("navigatesuccess",e):setInterval(e,Ze)}};i(v,"Context"),s([C],v.prototype,"_initialize",1),v=s([g],v);var ie=class ie{constructor(){a(this,"pending",[]);a(this,"flushing",!1)}push(t){this.pending.push(t),this.flush()}flush(){return S(this,null,function*(){var e;if(this.flushing)return;this.flushing=!0;let t=this.pending.shift();for(;t!=null;){try{yield t.promise}catch(r){}try{(e=t.callback)==null||e.call(t)}catch(r){}t=this.pending.shift()}this.flushing=!1})}};i(ie,"AsyncQueue");var Lt=ie;var T=class{constructor(){a(this,"plugins",{adRequestQueued:t=>[],adRequestTimedOut:t=>[],adRequestBeforeRelease:t=>[],adRequestCompleted:t=>[]});a(this,"queue",new Lt);a(this,"adRequestCounter",0)}_queueAdRequest(t={}){var l,d;let e={index:this.adRequestCounter++,status:"queued",timeoutValue:(l=t.timeout)!=null?l:0,onDvtagReadyCalled:(d=t.timestamp)!=null?d:0,waitingStarted:new Date().getTime(),internal:t.internal};this.core.get(v).updateVisit(),this.plugins.adRequestQueued(e);let r=t.callback;r===void 0?t.callback=()=>{}:r===null?e.status="tag-timeout":t.callback=()=>{e.status="queue-timeout",e.callbackCalled=new Date().getTime(),t.callback=null,this.plugins.adRequestTimedOut(e);try{r()}catch(m){}};let n=i(()=>{if(t.callback!=null){t.callback=null,e.status="success",e.callbackCalled=new Date().getTime(),this.plugins.adRequestBeforeRelease(e);try{r==null||r()}catch(m){}}else this.plugins.adRequestBeforeRelease(e);e.waitingEnded=new Date().getTime(),this.plugins.adRequestCompleted(e)},"onAsyncOperationsCompleted");this.queue.push({callback:n,adRequest:e})}delayAdRequests(t){this.queue.push({promise:t})}};i(T,"AdRequestQueue"),s([rt("queueAdRequest")],T.prototype,"_queueAdRequest",1),T=s([g],T);var $=class{getShortCommitId(){return"f1de76b"}getBuildTimestamp(){return 1736658023337}getAuthToken(){return"qnMCF+YdivYcxUUGURencubsUgNOlqMPfVKrwB2FCtaHdaSNRJX2wj3PceFDXjJnYLmanadoCb88WJoxgXmCzVeisT8w4i9EmQsujV+G4Ku5XVfGqUa2DyWHbVXmPfASADYfXUewcmesOZ8koYgrIDfG6kfm4GQ="}};i($,"DefinedVariables"),$=s([g],$);var G=class{constructor(){a(this,"cache",{})}_performFetchJson(t,e){return S(this,null,function*(){let r=t;if(e!=null&&e.authToken){let d=this.core.get($).getAuthToken(),m=new URL(t);m.searchParams.set("token",d),r=m.href}let n=yield this.core.window.fetch(r);return{json:yield n.json(),headers:n.headers}})}fetchJson(t,e){return S(this,null,function*(){let r=this.cache[t];return r==null&&(r=this._performFetchJson(t,e).then(n=>n.json),this.cache[t]=r),r})}};i(G,"Fetch"),G=s([g],G);var Ct=["BSC","ABS","CCT","CBS"],se=["IDS"],xt=["VLP","TVP"],rr=[...Ct,...se,...xt],ji=[...Ct,...se,...xt].filter(o=>o!=="CCT"),ve=i(o=>rr.includes(o.toUpperCase()),"isSignal"),be=i(o=>xt.includes(o.toUpperCase()),"isSlotSignal"),we=i(o=>se.includes(o.toUpperCase()),"isUserSignal"),Ce=i(o=>Ct.includes(o.toUpperCase()),"isPageSignal");var Ft=i(o=>o==null?"":`@${o}`,"getPositionSuffix");var or=/^(\d+)x(\d+)$/,xe=i(o=>o==="all"?[]:o.split(",").map(t=>{let e=t.match(or);return e==null?{label:t}:{width:parseInt(e[1],10),height:parseInt(e[2],10)}}),"stringToSlotSizes"),ae=i(o=>o.length===0?"all":o.map(({width:t,height:e,label:r})=>r!=null?r:`${t}x${e}`).join(","),"slotSizesToString"),Pe=i(o=>o==null?"":o.length>0&&o.every(({label:r})=>r==null)?ae(o):"","slotSizesToStringIfSpecific");var nr="https://pub.doubleverify.com/dvtag/signals/",Q=class{_getBaseUrl(t){let e=this.core.get(v),{ctx:r,cmp:n}=e.getTagInfo(),l=e.getNormalizedPageUrl();try{l=new URL(l).origin}catch(m){}let d=new URL(t,nr);return d.searchParams.set("ctx",r),d.searchParams.set("cmp",n),d.searchParams.set("url",l),d}getUserTargetingUrl(t){let e=this._getBaseUrl("ids/pub.json");return t.includes("IDS")&&e.searchParams.set("ids","1"),e.href}getPageTargetingUrl(t,e){let r=this._getBaseUrl("bsc/pub.json");return r.searchParams.set("url",e),t.includes("BSC")&&r.searchParams.set("bsc","1"),t.includes("ABS")&&r.searchParams.set("abs","1"),t.includes("CBS")&&r.searchParams.set("cbs","1"),t.includes("CCT")&&r.searchParams.set("cct","1"),r.href}getSlotTargetingUrl(t,e){var l;let r=this._getBaseUrl("vlp/pub.json");t.includes("VLP")&&r.searchParams.set("vlp","1"),t.includes("TVP")&&r.searchParams.set("tvp","1");let n=0;for(let d of e){let{id:m,position:h,sizes:f}=(l=d.adUnit)!=null?l:{},A=m+Ft(h);r.searchParams.set(`slot-${n++}-${A}`,Pe(f))}return r.href}};i(Q,"SignalsUrlBuilder"),Q=s([g],Q);var at=class{constructor(){a(this,"cache",{})}_fetchFreshSignals(t,e){return S(this,null,function*(){if(!e.some(Ce))return{};let r=this.core.get(Q).getPageTargetingUrl(e,t),n;try{n=yield this.core.get(G).fetchJson(r,{authToken:!0})}catch(l){return{}}return n instanceof Object?n:{}})}fetchSignals(t,e=3){return S(this,null,function*(){let r=this.core.get(v),n=r.getNormalizedPageUrl(),l=r.getStrippedPageUrl();this.cache[l]==null&&(this.cache[l]=this._fetchFreshSignals(n,t));let d=yield this.cache[l];return this.core.get(v).getStrippedPageUrl()!==l&&e>0?this.fetchSignals(t,e-1):d})}};i(at,"PageSignals"),at=s([g],at);var lt=class{constructor(){a(this,"cache",{});a(this,"pendingSlots",[]);a(this,"pendingBulkRequest",null)}_scheduleBulkRequest(t){return S(this,null,function*(){yield Promise.resolve();let e=this.core.get(Q).getSlotTargetingUrl(t,this.pendingSlots);this.pendingSlots=[],this.pendingBulkRequest=null;let r;try{r=yield this.core.get(G).fetchJson(e,{authToken:!0})}catch(n){return[]}return r})}_fetchFreshSignals(t,e){return S(this,null,function*(){if(!e.some(be))return{};let r=this.pendingSlots.push(t)-1;this.pendingBulkRequest==null&&(this.pendingBulkRequest=this._scheduleBulkRequest(e));let l=(yield this.pendingBulkRequest)[r];return l instanceof Object?l:{}})}_getCacheKey(t){var m,h;let{id:e,position:r,sizes:n}=(m=t.adUnit)!=null?m:{},l=e+Ft(r),d=(h=n==null?void 0:n.map(f=>{var A;return(A=f.label)!=null?A:`${f.width}x${f.height}`}).sort().join(","))!=null?h:"";return`${l}#${d}`}fetchSignals(t,e){return S(this,null,function*(){let r=this._getCacheKey(t);return this.cache[r]==null&&(this.cache[r]=this._fetchFreshSignals(t,e)),this.cache[r]})}};i(lt,"SlotSignals"),lt=s([g],lt);var ut=class{constructor(){a(this,"cache")}_fetchFreshSignals(t){return S(this,null,function*(){if(!t.some(we))return{};let e=this.core.get(Q).getUserTargetingUrl(t),r;try{r=yield this.core.get(G).fetchJson(e,{authToken:!0})}catch(n){return{}}return r instanceof Object?r:{}})}fetchSignals(t){return S(this,null,function*(){return this.cache==null&&(this.cache=this._fetchFreshSignals(t)),this.cache})}};i(ut,"UserSignals"),ut=s([g],ut);var y=class{constructor(){a(this,"plugins",{getEnabledSignals:()=>[],userTargetingUpdated:t=>[],pageTargetingUpdated:t=>[],slotTargetingUpdated:(t,e)=>[]});a(this,"dataForMigrationTracking",{userTargeting:{},pageTargeting:{},slotTargeting:new Map})}getEnabledSignals(){return this.plugins.getEnabledSignals()}getDataForMigrationTracking(){return this.dataForMigrationTracking}_initialize(){this.getUserTargeting(),this.getPageTargeting()}_onAdRequestQueued(){this.getPageTargeting()}_onSlotDiscovered(t){this.getSlotTargeting(t)}getUserTargeting(){return S(this,null,function*(){let t=this._fetchUserTargeting();return this.core.get(T).delayAdRequests(t),t})}getPageTargeting(){return S(this,null,function*(){let t=this._fetchPageTargeting();return this.core.get(T).delayAdRequests(t),t})}getSlotTargeting(t){return S(this,null,function*(){let e=this._fetchSlotTargeting(t);return this.core.get(T).delayAdRequests(e),e})}_fetchUserTargeting(){return S(this,null,function*(){let t=yield this.core.get(ut).fetchSignals(this.getEnabledSignals());return this.core.get(E).setGlobalTargeting(t),this.dataForMigrationTracking.userTargeting=t,this.plugins.userTargetingUpdated(t),t})}_fetchPageTargeting(){return S(this,null,function*(){let t=yield this.core.get(at).fetchSignals(this.getEnabledSignals());return this.core.get(E).setGlobalTargeting(t),this.dataForMigrationTracking.pageTargeting=t,this.plugins.pageTargetingUpdated(t),t})}_fetchSlotTargeting(t){return S(this,null,function*(){let e=yield this.core.get(lt).fetchSignals(t,this.getEnabledSignals());return this.core.get(E).setSlotTargeting(t,e),this.dataForMigrationTracking.slotTargeting.set(t,e),this.plugins.slotTargetingUpdated(t,e),e})}};i(y,"Signals"),s([C],y.prototype,"_initialize",1),s([p(T,"adRequestQueued")],y.prototype,"_onAdRequestQueued",1),s([p(R,"slotDiscovered")],y.prototype,"_onSlotDiscovered",1),y=s([g],y);var B=class{constructor(){a(this,"pq",null)}getPq(){return this.pq==null&&(this.pq=this._initialize()),this.pq}getPts(){return this.getPq().PTS}setApi(t){let e=this.getPq();e!=null&&(e.init=()=>{},e.loadSignals=t.loadSignals,e.loadSignalsForSlots=t.loadSignalsForSlots,e.getTargeting=t.getTargeting)}_pushToDvtagCmd(...t){var e;this.core.dvtag.cmd=(e=this.core.dvtag.cmd)!=null?e:[],this.core.dvtag.cmd.push(...t)}_initialize(){var r,n;this.core.window.PQ=(r=this.core.window.PQ)!=null?r:{};let t=this.core.window.PQ;if(t.loaded)return{cmd:[],PTS:{}};t.loaded=!0,t.PTS=(n=t.PTS)!=null?n:{};let e=t.cmd;return t.cmd={push:l=>this._pushToDvtagCmd(l)},Array.isArray(e)&&this._pushToDvtagCmd(...e),t}};i(B,"LegacyPq"),B=s([g],B);var Ie=i(o=>{var r,n,l;let t=st(),e={id:(n=(r=o.adUnitPath)!=null?r:o.invCode)!=null?n:o.tagId,sizes:Tt(xe((l=o.sizes)!=null?l:"all")),position:o.position};return{elementId:t,adUnit:e}},"parseLegacyAdUnit");var Oe=i((o,t)=>{var n;let e=(n=o.IDS)==null?void 0:n[0];if(e==null)return;let r=parseInt(e);isNaN(r)||(t.IDS=r)},"setUserTargetingOnPts"),De=i((o,t)=>{for(let e of Ct)o[e]!=null&&(t[e]=o[e])},"setPageTargetingOnPts"),qe=i((o,t,e)=>{var m,h,f,A,L,q;let{adUnit:r}=o;if((r==null?void 0:r.id)==null)return;let n=r.id,l=ae((m=r.sizes)!=null?m:[]),d=r.position;for(let _ of xt){let F=t[_];F!=null&&((h=e[_])!=null||(e[_]={}),(A=(f=e[_])[n])!=null||(f[n]={}),e[_][n][l]=F[0],d!=null&&((q=(L=e[_][n])[d])!=null||(L[d]={}),e[_][n][d][l]=F[0]))}},"setSlotTargetingOnPts");var W=class extends w{_initialize(){this.core.get(B).setApi({loadSignals:this.loadSignals.bind(this),loadSignalsForSlots:this.loadSignalsForSlots.bind(this),getTargeting:this.getTargeting.bind(this)})}_setUserTargetingOnPts(t){let e=this.core.get(B).getPts();Oe(t,e)}_setPageTargetingOnPts(t){let e=this.core.get(B).getPts();De(t,e)}_setSlotTargetingOnPts(t,e){let r=this.core.get(B).getPts();qe(t,e,r)}loadSignals(t,e){return S(this,null,function*(){yield this._onDvtagReady("loadSignals",e)})}loadSignalsForSlots(t,e,r){return S(this,null,function*(){let n=this.core.get(y),l=this.core.get(R);for(let m of t){let h=m.getSlotElementId(),f=l.getSlot("gpt",h);if(f==null){let A=this.core.get(H).getAdPositionKey(m.getAdUnitPath());f=l.createSlot("gpt",0,h,Nt(m,A))}n.getSlotTargeting(f)}let d=typeof e=="function"?e:r;yield this._onDvtagReady("loadSignalsForSlots",d)})}getTargeting(t,e){return S(this,null,function*(){var d;let r=this.core.get(y),n=this.core.get(R);for(let m of(d=t.adUnits)!=null?d:[]){let{elementId:h,adUnit:f}=Ie(m),A=n.createSlot("legacy-api",0,h,f);r.getSlotTargeting(A)}let l=i(()=>e==null?void 0:e(void 0,this.core.get(B).getPts()),"callback");yield this._onDvtagReady("getTargeting",l)})}_getPubAdsTargeting(t){var e,r,n;return(n=(r=(e=this.core.window.googletag)==null?void 0:e.pubads)==null?void 0:r.call(e).getTargeting(t))!=null?n:[]}_onDvtagReady(t,e){return S(this,null,function*(){yield new Promise(r=>{this.core.window.dvtag.queueAdRequest({callback:()=>{try{e==null||e()}catch(n){}r()},timestamp:new Date().getTime(),timeout:750,internal:!0})})})}};i(W,"LegacyLayer"),s([C],W.prototype,"_initialize",1),s([p(y,"userTargetingUpdated")],W.prototype,"_setUserTargetingOnPts",1),s([p(y,"pageTargetingUpdated")],W.prototype,"_setPageTargetingOnPts",1),s([p(y,"slotTargetingUpdated")],W.prototype,"_setSlotTargetingOnPts",1),W=s([g],W);var pt=class extends w{_getEnabledSignals(){return"IDS"}};i(pt,"SignalsIds"),s([p(y,"getEnabledSignals")],pt.prototype,"_getEnabledSignals",1),pt=s([g],pt);var ft=class extends w{_getEnabledSignals(){return"BSC"}};i(ft,"SignalsBsc"),s([p(y,"getEnabledSignals")],ft.prototype,"_getEnabledSignals",1),ft=s([g],ft);var ht=class extends w{_getEnabledSignals(){return"VLP"}};i(ht,"SignalsVlp"),s([p(y,"getEnabledSignals")],ht.prototype,"_getEnabledSignals",1),ht=s([g],ht);var St=class extends w{_getEnabledSignals(){return"TVP"}};i(St,"SignalsTvp"),s([p(y,"getEnabledSignals")],St.prototype,"_getEnabledSignals",1),St=s([g],St);var Rt=class extends w{_getEnabledSignals(){return"ABS"}};i(Rt,"SignalsAbs"),s([p(y,"getEnabledSignals")],Rt.prototype,"_getEnabledSignals",1),Rt=s([g],Rt);var P=class{getWindow(){return this.core.window}getDocument(){return this.getWindow().document}getUserAgent(){var t,e;return(e=(t=this.getWindow().navigator)==null?void 0:t.userAgent)!=null?e:""}getPageUrl(){var t,e;return(e=(t=this.getWindow().location)==null?void 0:t.href)!=null?e:""}getHostname(){return new URL(this.getPageUrl()).hostname}getNavigator(){return this.getWindow().navigator}getPerformance(){var t;return(t=this.getWindow().performance)!=null?t:{}}getPerformanceTimeMs(){var t,e,r;return Math.floor((r=(e=(t=this.getPerformance()).now)==null?void 0:e.call(t))!=null?r:null)}isInQuirksMode(){return this.getDocument().compatMode==="BackCompat"}};i(P,"Environment"),P=s([g],P);var Ue=i((o,t=!0)=>{let e=document.createElement("script");return e.setAttribute("src",o),t&&e.setAttribute("async",""),e},"createScriptElement");var It=i(o=>{try{return o&&(o.contentDocument||o.contentWindow&&o.contentWindow.document||frames&&frames[o.name]&&frames[o.name].document)}catch(t){return null}},"getIframeDocument");var yt=i((o,t)=>{try{if(It(o)===null)return!0;if(o.src===""||o.src==="about:blank")return!1;let e=new URL(o.src),r=new URL(t.location.href);return e.origin!==r.origin}catch(e){return!0}},"isCrossOriginIframe");var ir="google_ads_iframe_",Me=i(o=>{if(o==null)return null;let t=o.querySelectorAll(`iframe[id^="${ir}"]`);return t.length===1?t[0]:null},"lookupGptIframe");var Ne=i((o,t)=>{var m;let e=o.document.getElementById(t);if(e==null)return{element:null};let r=Me(e);if(r==null)return{element:e};if(yt(r,o))return{element:r};let l=It(r),d=(m=l==null?void 0:l.body)!=null?m:null;return d==null?{element:r}:{element:d,parentIframe:r}},"getGptAdContainer");var dt=class{constructor(){a(this,"_getGptAdContainer",Ne)}getAdContainer(t){let e=this.core.get(P).getWindow();return t.source==="gpt"?this._getGptAdContainer(e,t.elementId):{element:e.document.getElementById(t.elementId)}}};i(dt,"AdLocator"),dt=s([g],dt);var I=class{constructor(){a(this,"adEmpty",new M);a(this,"adRequestInFlight",new M);a(this,"nonEmptyAdResponses",new M);a(this,"plugins",{adRequested:t=>[],adRequestedOrInferred:t=>[],adRendered:(t,e,r)=>[],adRemoved:t=>[]})}setAdRequested(t){this.adRequestInFlight.set(t,!0),this.plugins.adRequested(t),this.plugins.adRequestedOrInferred(t)}setAdRendered(t,e){this.adRequestInFlight.get(t)!==!0&&this.plugins.adRequestedOrInferred(t),this.setAdRemoved(t),this.adEmpty.set(t,!1),this.adRequestInFlight.set(t,!1),e!=null&&this.nonEmptyAdResponses.set(t,this.nonEmptyAdResponses.getOrDefault(t,0)+1);let r=this.core.get(dt).getAdContainer(t);this.plugins.adRendered(t,e,r)}setAdRemoved(t){this.adEmpty.get(t)===!1&&(this.adEmpty.set(t,!0),this.plugins.adRemoved(t))}getNonEmptyAdRenderedCount(t){return this.nonEmptyAdResponses.getOrDefault(t,0)}};i(I,"AdServerHub"),I=s([g],I);var V=class{getPubAds(){var e,r;let t=this.core.get(P).getWindow();try{return(r=(e=t.googletag)==null?void 0:e.pubads)==null?void 0:r.call(e)}catch(n){return}}onPubAdsReady(t){var n,l,d,m;let e=this.core.get(P).getWindow();e.googletag=(n=e.googletag)!=null?n:{},e.googletag.cmd=(l=e.googletag.cmd)!=null?l:[];let r=this.getPubAds();if(r!=null)t(r);else try{(m=(d=e.googletag.cmd)==null?void 0:d.push)==null||m.call(d,()=>{r=this.getPubAds(),r!=null&&t(r)})}catch(h){}}};i(V,"GoogletagPubAds"),V=s([g],V);var b=class{constructor(){a(this,"gptReference",new M);a(this,"plugins",{slotDiscovered:(t,e)=>[],slotDestroyed:t=>[]})}_scanForSlots(){this.core.get(V).onPubAdsReady(t=>{t.getSlots().map(e=>this.maybeDiscoverSlot(e,0))})}getGptSlot(t){return this.gptReference.get(t)}maybeDiscoverSlot(t,e){let r=this.core.get(R).getSlot("gpt",t.getSlotElementId());return r==null||this.gptReference.get(r)!==t?this._createSlot(t,e):r}_createSlot(t,e){let r=t.getSlotElementId(),n=t.getAdUnitPath(),l=Mt(n),d=this.core.get(H).getAdPositionKey(l),m=Nt(t,d);return this.core.get(R).createSlot("gpt",e,r,m,f=>this.gptReference.set(f,t))}_onSlotDiscovered(t,e){t.source==="gpt"&&this.plugins.slotDiscovered(t,e)}_onSlotDestroyed(t){t.source==="gpt"&&this.plugins.slotDestroyed(t)}};i(b,"GoogletagSlots"),s([C,p(T,"adRequestQueued")],b.prototype,"_scanForSlots",1),s([p(R,"slotDiscovered")],b.prototype,"_onSlotDiscovered",1),s([p(R,"slotDestroyed")],b.prototype,"_onSlotDestroyed",1),b=s([g],b);var X=class{constructor(){a(this,"plugins",{adRemoved:t=>[]})}_monitorAdRemoval(t){if(t.source!=="gpt")return;let e=this.core.get(P).getDocument().getElementById(t.elementId);if(e==null)return;new MutationObserver(n=>{let l=n.length,d=[...n].reverse(),m=0,h=e.children.length;for(let f of d){if(h===0){this.plugins.adRemoved(t);break}if(m===l-1)break;let A=f.removedNodes.length-f.addedNodes.length;h+=A,m++}}).observe(e,{childList:!0})}_onSlotDestroyed(t){this.plugins.adRemoved(t)}};i(X,"GoogletagAdRemoved"),s([p(b,"slotDiscovered")],X.prototype,"_monitorAdRemoval",1),s([p(b,"slotDestroyed")],X.prototype,"_onSlotDestroyed",1),X=s([g],X);var Qt=i(o=>{if(typeof o=="string"||Array.isArray(o)&&o.length===2&&o.every(t=>typeof t=="number"))return o},"cleanSizeInput");var N=i(o=>{if(typeof o=="string")return o;if(typeof o=="number")return`${o}`},"cleanStringInput");var J=class{constructor(){a(this,"plugins",{adRequested:t=>[],adRendered:(t,e)=>[]})}_initialize(){this.core.get(V).onPubAdsReady(t=>{t.addEventListener("slotRequested",e=>{let r=this.core.get(b).maybeDiscoverSlot(e.slot,1);this.plugins.adRequested(r)}),t.addEventListener("slotRenderEnded",e=>{let r=this.core.get(b).maybeDiscoverSlot(e.slot,2);if(e.isEmpty){this.plugins.adRendered(r,null);return}let n={advertiserId:N(e.advertiserId),campaignId:N(e.campaignId),creativeId:N(e.creativeId),lineItemId:N(e.lineItemId),renderedSize:Qt(e.size)};this.plugins.adRendered(r,n)})})}};i(J,"GoogletagEvents"),s([C],J.prototype,"_initialize",1),J=s([g],J);var ot=class{getAdServerTargeting(t,e){var d,m;let r=this.core.get(b).getGptSlot(t);if(r==null)return[];let n=[];try{n=this._cleanTargeting((m=(d=this.core.get(V).getPubAds())==null?void 0:d.getTargeting)==null?void 0:m.call(d,e))}catch(h){}let l=[];try{l=this._cleanTargeting(r.getTargeting(e))}catch(h){}return mt(n,l)}setAdServerTargeting(t,e,r){let n=this.core.get(b).getGptSlot(t);if(n!=null)try{n.setTargeting(e,r)}catch(l){}}_cleanTargeting(t){return typeof t=="string"?[t]:t instanceof Array?t.filter(e=>typeof e=="string"):[]}};i(ot,"GoogletagTargeting"),ot=s([g],ot);var k=class{_onAdRequested(t){this.core.get(I).setAdRequested(t)}_onAdRendered(t,e){this.core.get(I).setAdRendered(t,e)}_onAdRemoved(t){this.core.get(I).setAdRemoved(t)}_getAdServerTargeting(t,e){return t.source!=="gpt"?[]:this.core.get(ot).getAdServerTargeting(t,e)}_setAdServerTargeting(t,e,r){t.source==="gpt"&&this.core.get(ot).setAdServerTargeting(t,e,r)}};i(k,"Googletag"),s([p(J,"adRequested")],k.prototype,"_onAdRequested",1),s([p(J,"adRendered")],k.prototype,"_onAdRendered",1),s([p(X,"adRemoved")],k.prototype,"_onAdRemoved",1),s([p(E,"getAdServerTargeting")],k.prototype,"_getAdServerTargeting",1),s([p(E,"setAdServerTargeting")],k.prototype,"_setAdServerTargeting",1),k=s([g],k);var ct=i(()=>{var o,t,e;return Math.floor((e=(t=(o=window.performance)==null?void 0:o.now)==null?void 0:t.call(o))!=null?e:Date.now())},"perfNowOrDateNow");var le=class le{constructor(){a(this,"_firstQueuedAdRequest",1/0);a(this,"_lastQueuedAdRequest",-1/0);a(this,"_firstReleasedAdRequest",1/0);a(this,"_lastReleasedAdRequest",-1/0);a(this,"_lastReleasedAdRequestTime",null);a(this,"_hasBeenSuccessful",!1)}setAdRequestQueued(t){this._firstQueuedAdRequest=Math.min(this._firstQueuedAdRequest,t),this._lastQueuedAdRequest=Math.max(this._lastQueuedAdRequest,t)}setAdRequestReleased(t){this._firstReleasedAdRequest=Math.min(this._firstReleasedAdRequest,t),this._lastReleasedAdRequest=Math.max(this._lastReleasedAdRequest,t),this._lastReleasedAdRequestTime=ct()}getLastQueuedAdRequest(){return Number.isFinite(this._lastQueuedAdRequest)?this._lastQueuedAdRequest:null}getLastReleasedAdRequest(){return Number.isFinite(this._lastReleasedAdRequest)?this._lastReleasedAdRequest:null}getLastReleasedAdRequestTime(){return this._lastReleasedAdRequestTime}getLastSuccessfulAdRequest(){let t=Math.max(this._firstQueuedAdRequest,this._firstReleasedAdRequest),e=Math.min(this._lastQueuedAdRequest,this._lastReleasedAdRequest);return e<t?null:e}getPreviouslySuccessful(){return this._hasBeenSuccessful}markAdServerAdRequest(){this.getLastSuccessfulAdRequest()!=null&&(this._hasBeenSuccessful=!0),this._firstQueuedAdRequest=1/0,this._lastQueuedAdRequest=-1/0,this._firstReleasedAdRequest=1/0,this._lastReleasedAdRequest=-1/0,this._lastReleasedAdRequestTime=null}};i(le,"SlotAdRequestTracker");var Bt=le;var Vt=(d=>(d.UNKNOWN="UNKNOWN",d.SEEN="SEEN",d.NOT_READY="NOT_READY",d.POSSIBLE_TIMEOUT="POSSIBLE_TIMEOUT",d.PREV_READY="PREV_READY",d.READY="READY",d))(Vt||{});var ue="dv_upt_slot_ready",sr=["https://securepubads.g.doubleclick.net/gampad/ads?","https://pagead2.googlesyndication.com/gampad/ads?"],ar=750,O=class{constructor(){a(this,"plugins",{onSlotRequested:()=>[],onSlotRequestValidated:()=>[]});a(this,"validateAdRequests",!1);a(this,"lastAdRequestQueued",null);a(this,"lastAdRequestReleased",null);a(this,"state",{adRequestTracker:new M,triggered:new M})}_getSlotAdRequestTracker(t){return this.state.adRequestTracker.getOrDefaultFromFunction(t,()=>new Bt)}_onAdRequestQueued({index:t}){this.lastAdRequestQueued=t;for(let e of this.core.get(R).getSlots())this._getSlotAdRequestTracker(e).setAdRequestQueued(t),this.state.triggered.set(e,!1)}_onAdRequestBeforeRelease({index:t}){let e=this.core.get(E);this.lastAdRequestReleased=t;for(let r of this.core.get(R).getSlots())this._getSlotAdRequestTracker(r).setAdRequestReleased(t),this.validateAdRequests&&e.setSlotTargeting(r,{[ue]:["1"]})}_onSlotDiscovered(t,e){e===0&&this.lastAdRequestQueued!=null&&this._getSlotAdRequestTracker(t).setAdRequestQueued(this.lastAdRequestQueued)}_determineReadyState(t){let e=this._getSlotAdRequestTracker(t),r=e.getLastQueuedAdRequest(),n=e.getLastSuccessfulAdRequest(),l=e.getPreviouslySuccessful();return n!=null?"READY":l?"PREV_READY":r!=null?"NOT_READY":Date.now()-t.creationTime>ar?"SEEN":"UNKNOWN"}getSlotReadyStateOnAdServerAdRequest(t){let e=this._determineReadyState(t);if(e==="READY"){if(this.state.triggered.get(t)===!0)return{readyState:"PREV_READY"};this.state.triggered.set(t,!0);let r=this._getSlotAdRequestTracker(t).getLastReleasedAdRequestTime();return{readyState:e,readyFor:ct()-r}}return{readyState:e}}_onSlotRequested(t){let{readyState:e,readyFor:r}=this.getSlotReadyStateOnAdServerAdRequest(t);this._getSlotAdRequestTracker(t).markAdServerAdRequest(),this.validateAdRequests&&this.core.get(E).setSlotTargeting(t,{[ue]:["0"]}),this.plugins.onSlotRequested(t,e,r)}enableAdRequestValidation(){if(!this.validateAdRequests)try{let t=this._processResourceRequest.bind(this);new PerformanceObserver(r=>r.getEntries().forEach(t)).observe({type:"resource"}),this.validateAdRequests=!0}catch(t){}}_processResourceRequest(t){var e,r,n;try{if(sr.every(m=>!t.name.startsWith(m)))return;let d=(r=(e=new URL(t.name).searchParams.get("prev_scp"))==null?void 0:e.split("|"))!=null?r:[];for(let m of d){let f=((n=new URLSearchParams(m).get(ue))==null?void 0:n[0])==="1";this.plugins.onSlotRequestValidated(f)}}catch(l){}}};i(O,"SlotReadinessTracker"),s([p(T,"adRequestQueued")],O.prototype,"_onAdRequestQueued",1),s([p(T,"adRequestBeforeRelease"),p(T,"adRequestTimedOut")],O.prototype,"_onAdRequestBeforeRelease",1),s([p(R,"slotDiscovered")],O.prototype,"_onSlotDiscovered",1),s([p(I,"adRequested")],O.prototype,"_onSlotRequested",1),O=s([g],O);var de="__dvtag_debug_mode",ke="1",j=class{constructor(){a(this,"enabled",!1);a(this,"debugScriptLoaded",i(t=>{},"debugScriptLoaded"));a(this,"debugScriptLoadedPromise",new Promise(t=>{this.debugScriptLoaded=t}))}_initialize(){try{this.enabled=window===window.top&&this.core.window.sessionStorage.getItem(de)===ke}catch(t){}this.enabled&&(this.core.get(T).delayAdRequests(this.debugScriptLoadedPromise),this._loadDebugScript())}_toggleDebugMode(){return S(this,null,function*(){this.enabled?this.core.window.sessionStorage.removeItem(de):this.core.window.sessionStorage.setItem(de,ke),this.core.window.location.reload()})}_onDebugScriptLoaded(){this.debugScriptLoaded(void 0)}_loadDebugScript(){return S(this,null,function*(){let{ctx:t,cmp:e}=this.core.get(v).getTagInfo(),{document:r}=this.core.window,n=Ue(`https://pub.doubleverify.com/dvtag/${t}/${e}/debug.js`,!0);r.readyState==="loading"&&(yield new Promise(l=>r.addEventListener("DOMContentLoaded",()=>l(void 0)))),r.head.appendChild(n)})}_onAdRequestEvent(t){var e;(e=window.dvtagDebug)==null||e.adRequestEvent(t)}};i(j,"DebugScriptLoader"),s([C],j.prototype,"_initialize",1),s([rt("toggleDebugMode")],j.prototype,"_toggleDebugMode",1),s([rt("_debugScriptLoaded")],j.prototype,"_onDebugScriptLoaded",1),s([p(T,"adRequestQueued"),p(T,"adRequestBeforeRelease"),p(T,"adRequestTimedOut")],j.prototype,"_onAdRequestEvent",1),j=s([U(O),g],j);var ce="qt_loaded",jt="pts_pid",Le="pts_sid";var ge=i(o=>[...new Set(o.filter(ve).map(t=>t.toLowerCase()))],"getGreenlightSignal");var Z=class extends w{_autoInsertPageId(){this.core.get(E).setGlobalTargeting({[jt]:[this.core.get(v).getVisitUuid()]})}_autoInsertSlotId(t){this.core.get(E).setSlotTargeting(t,{[Le]:[t.uuid]})}_autoInsertGlobalTargeting(t){this.core.get(E).setGlobalTargeting({[ce]:ge(Object.keys(t))},!0)}_autoInsertSlotTargeting(t,e){this.core.get(E).setSlotTargeting(t,{[ce]:ge(Object.keys(e))},!0)}};i(Z,"SignalsAutoInsertion"),s([p(v,"newVisit")],Z.prototype,"_autoInsertPageId",1),s([p(R,"slotDiscovered")],Z.prototype,"_autoInsertSlotId",1),s([p(y,"userTargetingUpdated"),p(y,"pageTargetingUpdated")],Z.prototype,"_autoInsertGlobalTargeting",1),s([p(y,"slotTargetingUpdated")],Z.prototype,"_autoInsertSlotTargeting",1),Z=s([g,U(k),U(j)],Z);var lr="https://vtrk.doubleverify.com",Fe="dvtag",ur=1,dr=1,D=class{constructor(){a(this,"sharedDataPoints")}_onAdRequestCompleted(t){if(t.index!==0)return;let{timeoutValue:e,onDvtagReadyCalled:r,callbackCalled:n}=t,l=n!=null?n-r:e;this.fireEvent("ad-request",{cd111:t.status,cm106:t.index,cm107:l,cd112:t.internal?"legacy":"modern"},{sampleInterval:dr})}_handleError(t){this.fireEvent("log",{cd111:"error",cd112:t.message,cd113:t.trace.join("=>")},{sampleInterval:ur})}_getSharedDataPoints(){if(this.sharedDataPoints==null){let t=this.core.get(v),e=this.core.get($),r=this.core.get(P),{ctx:n,cmp:l,legacy:d}=t.getTagInfo(),m=r.getHostname(),h=t.getSessionUuid(),f=e.getShortCommitId();this.sharedDataPoints={cd102:f,cd103:"",cd107:h,cd109:d?"legacy":"modern",cd108:"",cd105:n,cd106:l,cd104:m}}return this.sharedDataPoints}fireEvent(t,e,{sampleInterval:r=1,trackerUuid:n=st(),spoofWrapperId:l=!1}={}){if(Math.random()>=1/r)return;e=Kt(qt(qt({},e),this._getSharedDataPoints()),{cd101:t,cm101:r});let d=Kt(qt({ec:Fe,ea:e.cd101,ctx:l?Fe:e.cd105,cmp:e.cd106},e),{cid:n,t:"event",v:1,z:n,cd160:n}),m=new URL(lr);for(let[h,f]of Object.entries(d))f!=null&&m.searchParams.set(h,`${f}`);this._sendBeacon(m.href)}_sendBeacon(t){try{typeof(navigator==null?void 0:navigator.sendBeacon)=="function"?navigator.sendBeacon(t):new Image().src=t}catch(e){}}};i(D,"Events"),s([p(T,"adRequestCompleted")],D.prototype,"_onAdRequestCompleted",1),s([fe],D.prototype,"_handleError",1),D=s([g],D);var cr=jt,Y=class{constructor(){a(this,"restoreCount",0)}getRestoreCount(){return this.restoreCount}_restoreTargeting(){let t=this.core.get(E);for(let e of this.core.get(R).getSlots())t.getAdServerTargeting(e,cr).length===0&&(t.setAdServerTargeting(e),this.restoreCount+=1)}};i(Y,"TargetingRestorer"),s([p(T,"adRequestQueued")],Y.prototype,"_restoreTargeting",1),Y=s([g],Y);var me=class me{constructor(){a(this,"total",0);a(this,"dataPoints",0)}push(t){return this.total+=t,this.dataPoints+=1,this}get(){return this.total/this.dataPoints}getRounded(){return Math.round(this.get())}};i(me,"Average");var Ot=me;var gr="implcheck",mr=1e-4,pr=5e3,fr=5,z=class{constructor(){a(this,"enabled",!1);a(this,"totalInternalAdRequestQueuedCount",0);a(this,"totalAdRequestsCompletedCount",0);a(this,"totalSlotsRequestedCount",0);a(this,"totalSlotsRequestedOkCount",0);a(this,"totalTimeoutCount",0);a(this,"trackersSent",0);a(this,"totalValidatedAdServerRequests",{ok:0,notOk:0});a(this,"lastOnDvtagReadyCall",NaN);a(this,"slotReqAvgTimeSinceCall",new Ot);a(this,"slotReqAvgTimeSinceDone",new Ot);a(this,"batch",null)}isDebugForceEnabled(){return!1}_initialize(){this.enabled=this.core.get(z).isDebugForceEnabled()||Math.random()<mr,this.enabled&&this.core.get(O).enableAdRequestValidation()}_onAdRequestQueued(t){this.enabled&&(this.lastOnDvtagReadyCall=ct(),t.internal&&(this.totalInternalAdRequestQueuedCount+=1))}_onAdRequestCompleted(t){this.enabled&&(this.totalAdRequestsCompletedCount+=1,(t.status==="tag-timeout"||t.status==="queue-timeout")&&(this.totalTimeoutCount+=1))}_onSlotRequested(t,e,r){if(!this.enabled)return;let n=this._getOrStartBatch();this.totalSlotsRequestedCount+=1,e==="READY"&&(this.totalSlotsRequestedOkCount+=1),n.slots[e].push(t.elementId),r!=null&&(this.slotReqAvgTimeSinceDone.push(r),this.slotReqAvgTimeSinceCall.push(ct()-this.lastOnDvtagReadyCall));let l=this._validateAdServerTargeting(t);l===1?n.targeting.extendedCount+=1:l===0&&(n.targeting.reducedCount+=1)}_validateAdServerTargeting(t){let e=this.core.get(E),r=2,n=e.getTargeting(t);for(let[l,d]of Object.entries(n)){let m=e.getAdServerTargeting(t,l);if(d.length>m.length||d.some(h=>!m.includes(h)))return 0;m.length>d.length&&(r=1)}return r}_onSlotRequestValidated(t){t?this.totalValidatedAdServerRequests.ok+=1:this.totalValidatedAdServerRequests.notOk+=1}_sendTracker(){let t=this.core.get(Y).getRestoreCount(),{slots:e,targeting:r,start:n}=this._getOrStartBatch(),l={cd110:e.READY.join(),cd111:e.PREV_READY.join(),cd112:e.SEEN.join(),cd113:e.NOT_READY.join(),cd114:e.UNKNOWN.join(),cd115:e.POSSIBLE_TIMEOUT.join(),cm106:this.trackersSent,cm107:n,cm109:this.totalTimeoutCount,cm110:this.slotReqAvgTimeSinceCall.getRounded(),cm111:this.slotReqAvgTimeSinceDone.getRounded(),cm112:this.totalSlotsRequestedOkCount,cm113:this.totalValidatedAdServerRequests.ok,cm114:this.totalValidatedAdServerRequests.notOk,cm115:t,cm116:this.totalAdRequestsCompletedCount,cm117:this.totalInternalAdRequestQueuedCount,cm118:this.totalSlotsRequestedCount,cm119:r.reducedCount,cm120:r.extendedCount};this.core.get(D).fireEvent(gr,l),this.batch=null,this.trackersSent+=1,this.trackersSent>=fr&&(this.enabled=!1)}_getOrStartBatch(){return this.batch==null&&(this.batch={start:ct(),slots:Object.fromEntries(Object.values(Vt).map(t=>[t,[]])),targeting:{extendedCount:0,reducedCount:0}},setTimeout(()=>this._sendTracker(),pr)),this.batch}};i(z,"ImplementationValidator"),s([C],z.prototype,"_initialize",1),s([p(T,"adRequestQueued")],z.prototype,"_onAdRequestQueued",1),s([p(T,"adRequestCompleted")],z.prototype,"_onAdRequestCompleted",1),s([p(O,"onSlotRequested")],z.prototype,"_onSlotRequested",1),s([p(O,"onSlotRequestValidated")],z.prototype,"_onSlotRequestValidated",1),z=s([g],z);var tt=class{_defineSlot(t,e={}){if(typeof t!="string"||e==null||typeof e!="object")return;let r={id:N(e.id),network:N(e.network),sizes:e.sizes!=null?Tt(e.sizes):void 0,position:N(e.position)};this.core.get(R).createSlot("custom",0,t,r)}_adRendered(t,e){if(typeof t!="string"||e==null||typeof e!="object")return;let r=this.core.get(R).getSlot("custom",t);if(r==null)return;let n={advertiserId:N(e.advertiserId),campaignId:N(e.campaignId),creativeId:N(e.creativeId),lineItemId:N(e.lineItemId),renderedSize:Qt(e.renderedSize)};this.core.get(I).setAdRendered(r,n)}_adRemoved(t){if(typeof t!="string")return;let e=this.core.get(R).getSlot("custom",t);e!=null&&this.core.get(I).setAdRemoved(e)}_getTargeting(t){let e=this.core.get(E);if(typeof t!="string")return e.getTargeting();let r=this.core.get(R).getSlot("custom",t);return e.getTargeting(r)}};i(tt,"CustomAdServer"),s([rt("defineSlot")],tt.prototype,"_defineSlot",1),s([rt("getTargeting")],tt.prototype,"_getTargeting",1),tt=s([g],tt);var hr=5e3,Ge=i(o=>o.readyState==="interactive"||o.readyState==="complete","isDocumentReady"),Qe=i((r,n,...l)=>S(void 0,[r,n,...l],function*(o,t,e=hr){var f;let d=(f=o.parentIframe)!=null?f:o.element;if(!(d instanceof HTMLIFrameElement))return"no-iframe";let m=It(d);if(m==null||yt(d,t))return"cross-origin";let h;try{h=Ge(m)}catch(A){return"error"}return h?"prev-ready":yield new Promise(A=>{let L=i(()=>{let _;try{_=Ge(m)}catch(F){q("error");return}_&&q("state-change")},"listener"),q=i(_=>{try{m.removeEventListener("readystatechange",L)}catch(F){}A(_)},"cleanupAndResolve");try{m.addEventListener("readystatechange",L)}catch(_){A("error")}setTimeout(()=>q("timeout"),e)})}),"waitForIFrameReadyState");var Sr="iframe-ready-experiment",Rr=1/1e6,nt=class{constructor(){a(this,"_waitForIFrameReadyState",Qe);a(this,"_isCrossOriginIframe",yt)}_shouldActivate(t=Rr){return Math.random()<=t}_onAdRendered(t,e,r){return S(this,null,function*(){var Dt,et,K;if(!this._shouldActivate())return;let n=this.core.get(P).getWindow(),l=e==null,d=(Dt=r.parentIframe)!=null?Dt:r.element,m=d instanceof HTMLIFrameElement,h=m&&this._isCrossOriginIframe(d,n),f=(et=this.core.get(b).getGptSlot(t))==null?void 0:et.getHtml(),A=f!=null,L=(K=f==null?void 0:f.length)!=null?K:0,q=f==null?void 0:f.substring(0,Math.min(L,100)),_=Date.now(),F=yield this._waitForIFrameReadyState(r,n),_t=Date.now()-_;this.core.get(D).fireEvent(Sr,{cd120:F,cd121:e==null?void 0:e.creativeId,cd122:q,cm120:_t,cm121:l?1:0,cm122:m?1:0,cm123:h?1:0,cm124:A?1:0,cm125:L})})}};i(nt,"IframeReadyState"),s([p(I,"adRendered")],nt.prototype,"_onAdRendered",1),nt=s([g],nt);var it=class{constructor(){a(this,"initialized",!1);a(this,"size",0)}_initialize(){return S(this,null,function*(){if(yield Promise.resolve(),this.initialized)return;this.initialized=!0,this.core.dvtag.cmd instanceof Array||(this.core.dvtag.cmd=[]);let t=this.core.dvtag.cmd;this.core.dvtag.cmd={push:(...e)=>{for(let r of e)try{r()}catch(n){}return this.size+=e.length,this.size}},this.core.dvtag.cmd.push(...t)})}};i(it,"CommandBuffer"),s([C],it.prototype,"_initialize",1),it=s([g],it);var Et=class{};i(Et,"HouseHold"),Et=s([g,U(T),U(it),U(D),U(tt),U(Y),U(nt)],Et);if(window.dvtag==null||window.dvtag._core==null)try{new bt(Jt,window)}catch(o){}})();
